# ๐พ ูุธุงู ุงูุฐุงูุฑุฉ - Memory System

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุธุงู ุฐุงูุฑุฉ ูุชูุฏู ูุจูู ุนูู **PostgreSQL** ูุญูุธ ุฌููุน ุงููุญุงุฏุซุงุช ูุงูุฑุณุงุฆูุ ููุชุนุฑู ุนูู ุงููุณุชุฎุฏููู ูุชูุถููุงุชููุ ููููุฑ ุณูุงู ุงููุญุงุฏุซุงุช ุงูุณุงุจูุฉ ูููููุงุก ุงูุฐููุฉ.

---

## โจ ุงูููุฒุงุช

### 1. **ุญูุธ ุงููุญุงุฏุซุงุช ุงูุชููุงุฆู**
- โ ูู ุฑุณุงูุฉ ุชูุญูุธ ุชููุงุฆูุงู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ุฑุจุท ุงููุญุงุฏุซุงุช ุจุงููุณุชุฎุฏููู
- โ ุฏุนู ุงูุฌูุณุงุช (Sessions)

### 2. **ุงูุณูุงู ุงูุฐูู**
- โ ุงููููู ูุชุฐูุฑ ุงููุญุงุฏุซุงุช ุงูุณุงุจูุฉ
- โ ูุณุชุฎุฏู ุงูุณูุงู ูููู ุงูุทูุจุงุช ุจุดูู ุฃูุถู
- โ ูุชุนุฑู ุนูู ุชูุถููุงุช ุงููุณุชุฎุฏู

### 3. **ุงูุชุญูููุงุช ูุงูุฅุญุตุงุฆูุงุช**
- โ ุงูููุงูุง ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู
- โ ุงูููุตุงุช ุงูููุถูุฉ
- โ ุฅุญุตุงุฆูุงุช ุดุงููุฉ

---

## ๐๏ธ ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู:

#### 1. `conversations` - ุงููุญุงุฏุซุงุช
```sql
- id: ูุนุฑู ุงููุญุงุฏุซุฉ
- user_id: ูุนุฑู ุงููุณุชุฎุฏู
- session_id: ูุนุฑู ุงูุฌูุณุฉ
- title: ุนููุงู ุงููุญุงุฏุซุฉ
- created_at: ุชุงุฑูุฎ ุงูุฅูุดุงุก
- updated_at: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
```

#### 2. `messages` - ุงูุฑุณุงุฆู
```sql
- id: ูุนุฑู ุงูุฑุณุงูุฉ
- conversation_id: ูุนุฑู ุงููุญุงุฏุซุฉ
- role: ุฏูุฑ ุงููุฑุณู (user, assistant, system)
- content: ูุญุชูู ุงูุฑุณุงูุฉ
- intent: ุงูููุฉ ุงูููุชุดูุฉ
- confidence: ูุณุชูู ุงูุซูุฉ
- agent: ุงููููู ุงูุฐู ุนุงูุฌ ุงูุฑุณุงูุฉ
- metadata: ุจูุงูุงุช ุฅุถุงููุฉ (JSON)
- created_at: ุชุงุฑูุฎ ุงูุฅุฑุณุงู
```

---

## ๐ ุงูุงุณุชุฎุฏุงู

### 1. ุชููุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช

```bash
# ุชุฃูุฏ ูู ุชุดุบูู PostgreSQL
# ุซู ุดุบู ุงูุฎุงุฏู - ุณูุชู ุฅูุดุงุก ุงูุฌุฏุงูู ุชููุงุฆูุงู
python app/main.py
```

### 2. ุงููุญุงุฏุซุฉ ูุน ุงูุฐุงูุฑุฉ

ุงูุฐุงูุฑุฉ ุชุนูู ุชููุงุฆูุงู! ููุท ุงุณุชุฎุฏู ุงูุดุงุชุจูุช ูุงููุนุชุงุฏ:

```python
# WebSocket
{
  "message": "ูุฑุญุจุงู",
  "user_id": 1,
  "session_id": "session_123"
}
```

---

## ๐ก API Endpoints

### 1๏ธโฃ ุงูุญุตูู ุนูู ูุญุงุฏุซุงุช ุงููุณุชุฎุฏู

**Endpoint:** `GET /api/conversations/`

**Parameters:**
- `user_id`: ูุนุฑู ุงููุณุชุฎุฏู
- `limit`: ุนุฏุฏ ุงููุญุงุฏุซุงุช (ุงูุชุฑุงุถู: 20)

**Response:**
```json
[
  {
    "id": 1,
    "user_id": 1,
    "session_id": "session_123",
    "title": "ูุฑุญุจุงู",
    "created_at": "2024-01-22T00:00:00",
    "updated_at": "2024-01-22T00:10:00",
    "message_count": 8
  }
]
```

---

### 2๏ธโฃ ุงูุญุตูู ุนูู ุชูุงุตูู ูุญุงุฏุซุฉ

**Endpoint:** `GET /api/conversations/{conversation_id}`

**Response:**
```json
{
  "conversation": {
    "id": 1,
    "title": "ูุฑุญุจุงู",
    "message_count": 8
  },
  "messages": [
    {
      "id": 1,
      "role": "user",
      "content": "ูุฑุญุจุงู",
      "intent": "greeting",
      "confidence": "0.95",
      "agent": "Main_Agent",
      "created_at": "2024-01-22T00:00:00"
    },
    {
      "id": 2,
      "role": "assistant",
      "content": "ูุฑุญุจุงู! ๐ ููู ูููููู ูุณุงุนุฏุชูุ",
      "intent": "greeting",
      "agent": "Main_Agent",
      "created_at": "2024-01-22T00:00:01"
    }
  ]
}
```

---

### 3๏ธโฃ ุงูุญุตูู ุนูู ุชูุถููุงุช ุงููุณุชุฎุฏู

**Endpoint:** `GET /api/conversations/user/{user_id}/preferences`

**Response:**
```json
{
  "total_conversations": 15,
  "common_intents": [
    "create_post",
    "add_account",
    "get_analytics"
  ],
  "preferred_platforms": [
    "twitter",
    "instagram"
  ],
  "last_interaction": "2024-01-22T00:10:00"
}
```

---

### 4๏ธโฃ ุฅุญุตุงุฆูุงุช ุงููุญุงุฏุซุงุช

**Endpoint:** `GET /api/conversations/stats/summary`

**Parameters:**
- `user_id`: ูุนุฑู ุงููุณุชุฎุฏู

**Response:**
```json
{
  "total_conversations": 15,
  "total_messages": 120,
  "top_intents": [
    {"intent": "create_post", "count": 45},
    {"intent": "add_account", "count": 30},
    {"intent": "get_analytics", "count": 25}
  ],
  "last_conversation": "2024-01-22T00:10:00"
}
```

---

### 5๏ธโฃ ุญุฐู ูุญุงุฏุซุฉ

**Endpoint:** `DELETE /api/conversations/{conversation_id}`

**Response:**
```json
{
  "status": "success",
  "message": "ุชู ุญุฐู ุงููุญุงุฏุซุฉ ุจูุฌุงุญ",
  "conversation_id": 1
}
```

---

## ๐ง ููู ูุนูู ุงูุณูุงูุ

### ูุซุงู ุนููู:

```
ุงููุณุชุฎุฏู: "ุฃุถู ุญุณุงุจ ุชููุชุฑ"
ุงููุณุงุนุฏ: "ุณุฃุณุงุนุฏู ูู ุฅุถุงูุฉ ุญุณุงุจ ุชููุชุฑ..."

ุงููุณุชุฎุฏู: "ุงุณู ุงููุณุชุฎุฏู test_user"
ุงููุณุงุนุฏ: [ูุชุฐูุฑ ุฃูู ุชุฑูุฏ ุฅุถุงูุฉ ุญุณุงุจ]
         "ุญุณูุงูุ ุงุณู ุงููุณุชุฎุฏู test_user. ูุง ูู ูููุฉ ุงููุฑูุฑุ"

ุงููุณุชุฎุฏู: "ูููุฉ ุงููุฑูุฑ pass123"
ุงููุณุงุนุฏ: [ูุชุฐูุฑ ุงูุงุณู ููููุฉ ุงููุฑูุฑ]
         "ุชูุงู! ุณุฃููู ุจุชุณุฌูู ุงูุฏุฎูู..."
```

### ููู ูุญุฏุซ ูุฐุงุ

1. **ุญูุธ ุชููุงุฆู**: ูู ุฑุณุงูุฉ ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. **ุงุณุชุฑุฌุงุน ุงูุณูุงู**: ุนูุฏ ุฑุณุงูุฉ ุฌุฏูุฏุฉุ ูุณุชุฑุฌุน ุขุฎุฑ 10 ุฑุณุงุฆู
3. **ุฅุถุงูุฉ ูููููู**: ุงูุณูุงู ููุถุงู ููุฑุณุงูุฉ ุงููุฑุณูุฉ ูููููู
4. **ููู ุฃูุถู**: ุงููููู ูููู ุงูุทูุจ ุจูุงุกู ุนูู ุงูุณูุงู

---

## ๐ฏ ุงูุชูุถููุงุช ุงูุฐููุฉ

ุงููุธุงู ูุชุนูู ูู ุงุณุชุฎุฏุงูู:

### ูุซุงู:

```
ุฅุฐุง ุงุณุชุฎุฏูุช ุชููุชุฑ 10 ูุฑุงุช ูุงูุณุชูุฑุงู 3 ูุฑุงุช:

ุงููุณุชุฎุฏู: "ุงูุดุฑ ููุดูุฑ"
ุงููุณุงุนุฏ: [ูุนุฑู ุฃูู ุชูุถู ุชููุชุฑ]
         "ูู ุชุฑูุฏ ุงููุดุฑ ุนูู ุชููุชุฑุ"
```

---

## ๐ง ุงูุชูุงูู ูุน ุงููููุงุก

### ูู ุงููููู ุงูุฑุฆูุณู:

```python
# ุงูุญุตูู ุนูู ุงูุณูุงู
context = memory_service.get_conversation_context(
    db, conversation_id, max_messages=10
)

# ุงูุญุตูู ุนูู ุงูุชูุถููุงุช
preferences = memory_service.get_user_preferences(db, user_id)

# ุฅุถุงูุฉ ููุฑุณุงูุฉ
enhanced_message = f"""
ุงูุณูุงู ุงูุณุงุจู:
{context}

ุงูุฑุณุงูุฉ ุงูุญุงููุฉ: {message}

ููุงุญุธุฉ: ุงููุณุชุฎุฏู ููุถู: {preferences['preferred_platforms']}
"""
```

---

## ๐ ุฃูุซูุฉ ุงูุงุณุชุฎุฏุงู

### 1. ุนุฑุถ ูุญุงุฏุซุงุชู

```bash
curl "http://localhost:5789/api/conversations/?user_id=1&limit=10"
```

### 2. ุนุฑุถ ูุญุงุฏุซุฉ ูุญุฏุฏุฉ

```bash
curl "http://localhost:5789/api/conversations/1"
```

### 3. ุชูุถููุงุชู

```bash
curl "http://localhost:5789/api/conversations/user/1/preferences"
```

### 4. ุงูุฅุญุตุงุฆูุงุช

```bash
curl "http://localhost:5789/api/conversations/stats/summary?user_id=1"
```

---

## ๐งช ุงูุงุฎุชุจุงุฑ

```bash
# ุงุฎุชุจุงุฑ ูุธุงู ุงูุฐุงูุฑุฉ
python test_memory_system.py
```

ุณูููู ุงูุงุฎุชุจุงุฑ ุจู:
1. โ ุฅูุดุงุก ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ
2. โ ุฅุฑุณุงู ุฑุณุงุฆู ูุชุณูุณูุฉ
3. โ ุนุฑุถ ุงููุญุงุฏุซุงุช
4. โ ุนุฑุถ ุชูุงุตูู ูุญุงุฏุซุฉ
5. โ ุนุฑุถ ุงูุชูุถููุงุช
6. โ ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช

---

## ๐จ ูู ุงููุงุฌูุฉ

ููููู ุฅุถุงูุฉ:

### 1. ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
```javascript
fetch('/api/conversations/?user_id=1')
  .then(res => res.json())
  .then(conversations => {
    // ุนุฑุถ ูุงุฆูุฉ ุงููุญุงุฏุซุงุช
  });
```

### 2. ุนุฑุถ ูุญุงุฏุซุฉ
```javascript
fetch('/api/conversations/1')
  .then(res => res.json())
  .then(data => {
    // ุนุฑุถ ุงูุฑุณุงุฆู
  });
```

### 3. ุฅุญุตุงุฆูุงุช ุงููุณุชุฎุฏู
```javascript
fetch('/api/conversations/stats/summary?user_id=1')
  .then(res => res.json())
  .then(stats => {
    // ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช
  });
```

---

## ๐ ุงูุฎุตูุตูุฉ ูุงูุฃูุงู

- โ ูู ูุณุชุฎุฏู ูุฑู ูุญุงุฏุซุงุชู ููุท
- โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ูู endpoint
- โ ุฅููุงููุฉ ุญุฐู ุงููุญุงุฏุซุงุช
- โ ุงูุจูุงูุงุช ุงูุญุณุงุณุฉ ูุดูุฑุฉ

---

## ๐ ุงูุฃุฏุงุก

- โ Indexes ุนูู ุงูุญููู ุงููููุฉ
- โ Pagination ูููุญุงุฏุซุงุช ุงููุซูุฑุฉ
- โ ุญุฏ ุฃูุตู ููุฑุณุงุฆู ุงููุณุชุฑุฌุนุฉ (10 ุงูุชุฑุงุถูุงู)
- โ Lazy loading ููุฑุณุงุฆู

---

## ๐ ุงูููุฒุงุช ุงููุณุชูุจููุฉ

- ๐ ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช
- ๐ ุชุตุฏูุฑ ุงููุญุงุฏุซุงุช
- ๐ ูุดุงุฑูุฉ ุงููุญุงุฏุซุงุช
- ๐ ุชูุฎูุต ุงููุญุงุฏุซุงุช ุงูุทูููุฉ
- ๐ ุงูุชุฑุงุญุงุช ุฐููุฉ ุจูุงุกู ุนูู ุงูุชุงุฑูุฎ

---

## โ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!

ุงููุธุงู ุงูุขู:
- โ ูุญูุธ ูู ูุญุงุฏุซุฉ ุชููุงุฆูุงู
- โ ูุชุฐูุฑ ุงููุณุชุฎุฏููู ูุชูุถููุงุชูู
- โ ูููุฑ ุณูุงู ูููููุงุก
- โ ูุนุฑุถ ุงููุญุงุฏุซุงุช ูุงูุฅุญุตุงุฆูุงุช

**ุงุณุชูุชุน ุจูุธุงู ุฐุงูุฑุฉ ุฐูู!** ๐พ๐ง
